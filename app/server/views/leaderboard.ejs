<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Quizzet-Recommender</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="css/metisMenu.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/sb-admin-2.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="css/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <style>
        #<%= users[currentUserIndex].username %> {
            background-color: lightgray;
        }

        .form-group > * {
            margin:5px 3px;
        }
    </style>

</head>

<body>
<div id="wrapper">
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Advanced Quizzet <sub>Human Intelligence Interpreted</sub></a>
        </div>

        <ul class="nav navbar-top-links navbar-right">
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-tasks">
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-star fa-5x" aria-hidden="true" style="color: gold; margin:auto;padding-left:15%;"></i>
                                <span class="pull-right">
                                    <h3><strong>Score : <%= score%> </strong></h3><span class="pull-right">points</span>
                                </span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <% if (score<=200){  %>
                                <strong><h3>Beginner</h3></strong>

                                <div class="progress progress-striped active" >
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="<%=score%>" aria-valuemin="0" aria-valuemax="100" style="width:<%=score/4 %>%" >
                                    </div>
                                </div>
                                <span class="pull-left">0</span><span class="pull-right">400</span>
                                <%} else if(score>200 && score<=300){%>
                                <strong>Intermediate</strong>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow=<%=score%> aria-valuemin="0" aria-valuemax="100" style="width:<%=score/4 %>%">

                                    </div>
                                </div>
                                <%} else {%>
                                <strong>Advanced</strong>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow=<%=score%> aria-valuemin="0" aria-valuemax="100" style="width:<%=score/4 %>%">

                                    </div>
                                </div>
                                <%}%>

                            </div>
                        </a>
                    </li>
                    <!--<li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 3</strong>
                                    <span class="pull-right text-muted">60% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                        <span class="sr-only">60% Complete (warning)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <p>
                                    <strong>Task 4</strong>
                                    <span class="pull-right text-muted">80% Complete</span>
                                </p>
                                <div class="progress progress-striped active">
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                        <span class="sr-only">80% Complete (danger)</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Tasks</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>-->
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-alerts">
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-comment fa-fw"></i> New Comment
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                <span class="pull-right text-muted small">12 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-envelope fa-fw"></i> Message Sent
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-tasks fa-fw"></i> New Task
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a href="#">
                            <div>
                                <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                <span class="pull-right text-muted small">4 minutes ago</span>
                            </div>
                        </a>
                    </li>
                    <li class="divider"></li>
                    <li>
                        <a class="text-center" href="#">
                            <strong>See All Alerts</strong>
                            <i class="fa fa-angle-right"></i>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="/userProfile"><i class="fa fa-user fa-fw"></i> User Profile</a>
                    </li>
                    <li><a href="/settings"><i class="fa fa-gear fa-fw"></i> Settings</a>
                    </li>
                    <li class="divider"></li>
                    <li><a href="/logout"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                    </li>
                </ul>
            </li>
        </ul>

        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li>
                        <div class="profile clearfix">
                            <div class="profile_pic">
                                <img src="" alt="..." style="padding-left: 25px;" id ="avatar">
                            </div>
                            <div class="profile_info">
                                <h4 id="fullname" style="padding-left: 5px; padding-right: 5px; text-align: center;"></h4>
                            </div>
                            <script>
                                var fullname = "<%= fullname %>";
                                var gender = "<%= gender %>";
                                if (gender === "Male") {
                                    document.getElementById("avatar").src = "images/male.png";
                                }
                                else {
                                    document.getElementById("avatar").src = "images/female.png";
                                }
                                document.getElementById("fullname").innerText = "Welcome, " + fullname;
                            </script>
                        </div>
                    </li>
                    <li>
                        <a href="/home"><i class="fa fa-home" aria-hidden="true"></i> Home</a>
                    </li>
                    <li>
                        <a href="/history"><i class="fa fa-history" aria-hidden="true"></i> History</a>
                    </li>
                    <li>
                        <a href="/leaderboard"><i class="fa fa-users" aria-hidden="true"></i> Leaderboard</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="page-wrapper">
        <br/>
        <div class="card mb-3">
            <div class="row">
                <div class="col-md-8">
                    <div class="card-header">
                        <h4><i class="fa fa-sort-amount-desc" aria-hidden="true"></i> Leaderboard :</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="sortCriteria">Sort By:</label>
                            <select class="form-control" id="sortCriteria" name="changeSortCriteria(this.value)" onchange="">
                                <option value="global">Global</option>
                                <option value="university">University</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>

            <script>

            </script>

            <% if (error === "") { %>
                <div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Username</th>
                                <th>University</th>
                                <th>Score</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <% var i = 0; %>
                            <% users.forEach(function (user) { %>
                                <% if (sortCriteria === "global" || (sortCriteria === "university" && user.university === users[currentUserIndex].university)) { %>
                                    <% i++; %>
                                    <tr class="clickable-row" id=<%= user.username %> >
                                        <td class="col-md-2"><%= i %></td>
                                        <td class="col-md-2"><%= user.username %></td>
                                        <td class="col-md-2"><%= user.university %></td>
                                        <td class="col-md-2"><%= user.overall_score %></td>
                                        <% if (friends.includes(user.username)) { %>
                                            <td class="col-md-2"><button class="btn btn-danger addFriend friend" id="<%= "add" + user.username %>" ><i class="fa fa-user-times" aria-hidden="true"></i></button></td>
                                        <% } else { %>
                                            <td class="col-md-2"><button class="btn btn-success addFriend" id="<%= "add" + user.username %>" ><i class="fa fa-user-plus" aria-hidden="true"></i></button></td>
                                        <% } %>
                                    </tr>
                                <% } %>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            <% } %>

        </div>
        <br/>
        <div class="alert alert-danger text-center" role="alert" id="error"></div>
    </div>

</div>

<!-- jQuery -->
<script src="js/vendor/jquery.min.js"></script>
<!-- Bootstrap Core JavaScript -->
<script src="js/vendor/bootstrap.min.js"></script>

<script>
    var error = "<%= error %>";
    $("document").ready(function () {
        $("#sortCriteria").val("<%= sortCriteria %>");
        $("#add" + "<%= users[currentUserIndex].username %>").remove();

        if (error !== "") {
            $(".alert").attr("hidden", false);
            $(".alert").text(error);
        } else {
            $(".alert").attr("hidden", true);
        }

        $("#sortCriteria").on("change", function () {
            var http = new XMLHttpRequest();
            var url = "/updateLeaderboard";
            var data = JSON.stringify({sortCriteria: this.value});
            http.open("POST", url, false);
            http.setRequestHeader("Content-Type", "application/json");
            http.send(data);

            window.open("/leaderboard", "_self");
        })

        $(".addFriend").on("click", function () {
            var friendName = this.id.substring(3);
            var buttonElement = $("#add" + friendName);

            var http = new XMLHttpRequest();
            var url = "/addRemoveFriend";
            http.open("POST", url, false);
            http.setRequestHeader("Content-Type", "application/json");

            var data = null;
            var response = null;

            if (buttonElement.hasClass("friend")) {
                data = JSON.stringify({username: friendName, type: "remove"});
                http.send(data);

                response = JSON.parse(http.responseText);
                if (response.error === "") {
                    $(".alert").attr("hidden", true);
                    buttonElement
                        .removeClass("btn-danger friend").addClass("btn-success")
                        .children("i").replaceWith("<i class=\"fa fa-user-plus\" aria-hidden=\"true\"></i>");
                } else {
                    $(".alert").attr("hidden", false);
                    $(".alert").text(response.error);
                }
            } else {
                data = JSON.stringify({username: friendName, type: "add"});
                http.send(data);

                response = JSON.parse(http.responseText);
                if (response.error === "") {
                    $(".alert").attr("hidden", true);
                    buttonElement
                        .removeClass("btn-success").addClass("btn-danger friend")
                        .children("i").replaceWith("<i class=\"fa fa-user-times\" aria-hidden=\"true\"></i>");
                } else {
                    $(".alert").attr("hidden", false);
                    $(".alert").text(response.error);
                }
            }
        });
    });
</script>

</body>

</html>
